#!/bin/sh
POOL=${1:-./brico/brico.pool}
INPUTS=$(dirname ${POOL})
OUTPUT_DIR="${INPUTS}_fresh"
OUTPUTS=${2:-${OUTPUT_DIR}}
if [ ! -d ${OUTPUTS} ]; then
    mkdir ${OUTPUTS};
fi;
if [ ! -z "${BRICOSOURCE}" ]; then
    export KNO_BRICOSOURCE=${BRICOSOURCE};
elif test -f ./brico/brico.pool; then
    export BRICOSOURCE=./brico/;
    export KNO_BRICOSOURCE=./brico/;
fi
rm -f ${OUTDIR}/*.index &&
index/index_core.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
index/index_english.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
index/index_lattice.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
index/index_relations.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
index/index_languages.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
index/index_termlogic.scm INDIR=${INPUTS} OUTDIR=${OUTPUTS} BRICOSOURCE=${BRICOSOURCE} ${POOL} &&
if [ ! -d ${INPUTS}/saved ]; then mkdir ${INPUTS}/saved; fi &&
mv ${INPUTS}/*.index ${INPUTS}/saved &&
mv ${OUTPUTS}/*.index ${INPUTS}
